---
sidebar: sidebar
permalink: use/enable-acp.html
keywords: Astra Control Provisioner install, acp, enable, astra trident upgrade, upgrade trident
summary: Enable Astra Control Provisioner to access advanced storage provisioning and management functionality.
---

= Enable Astra Control Provisioner
:hardbreaks:
:icons: font
:imagesdir: ../media/use/

[.lead]
Astra Trident versions 23.10 and later include the option to use Astra Control Provisioner, which enables licensed Astra Control users to access advanced storage provisioning functionality. Astra Control Provisioner provides this extended functionality in addition to standard Astra Trident CSI-based functionality.

In coming Astra Control updates, Astra Control Provisioner will replace Astra Trident as storage provisioner and orchestrator in the Astra Control architecture. As such, it's highly recommended that Astra Control users enable Astra Control Provisioner. Astra Trident will continue to remain open source and be released, maintained, supported, and updated with new CSI and other features from NetApp.

.About this task

You should follow this procedure if you are a licensed Astra Control Center user and you are looking to use Astra Control functionality. You should also follow this procedure if you are an Astra Trident user and want to use the additional functionality that Astra Control Provisioner provides without also using Astra Control.

For each case, the provisioner functionality is not enabled by default in Astra Trident 23.10 but can be enabled using this process.

.Before you begin

If you are enabling Astra Control Provisioner, do the following first:

[role="tabbed-block"]
====
.Astra Control Provisioners users with Astra Control Center

* *Install or upgrade to Astra Control Center 23.10*: You'll need this version if you are planning to use Astra Control Provisioner with Astra Control. 
//** You'll also need the link:../get-started/install_acc.html#install-the-netapp-astra-kubectl-plugin[kubectl plugin] you used during the installation process if you intend to download the Astra Control Provisioner from the NetApp Support Site.

* *Confirm that your cluster has an AMD64 system architecture*: The Astra Control Provisioner image is provided in both AMD64 and ARM64 CPU architectures, but only AMD64 is supported by Astra Control Center.

* *Obtain an Astra Control Center license*: You'll need an Astra Control Center license to download and enable Astra Control Provisioner and access the functionality it provides.

* *Confirm that your Astra Trident version is within a four-release window*: You can perform a direct upgrade to Astra Trident 23.10 with Astra Control Provisioner if your Astra Trident is within a four-release window of version 23.10. For example, you can directly upgrade from Astra Trident 22.10 to 23.10.

.Astra Control Provisioner only users
--

* *Confirm that your Astra Trident version is within a four-release window*: You can perform a direct upgrade to Astra Trident 23.10 with Astra Control Provisioner if your Astra Trident is within a four-release window of version 23.10. For example, you can directly upgrade from Astra Trident 22.10 to 23.10.

* *Get an Astra Control Service account for registry access*: Complete the registration for an https://bluexp.netapp.com/astra-register[Astra Control Service account^]. After you complete and submit the form and create a BlueXP account, you'll receive an Astra Control Service welcome email.

* *Obtain an Astra Control Center license*: Whether you are an existing Astra Control Center user or intend to use Astra Control Provisioner without Astra Control, you'll need an Astra Control Center license to enable Astra Control Provisioner and access the functionality it provides.

--
// end registry tab block

====
// end overall tabbed block

.Upgrade to Astra Control Provisioner 23.10

. Download and extract Astra Control Provisioner:
+
NOTE: Astra Control Center users can find the image using either method. For Astra Trident users wanting to use Astra Control Provisioner without Astra Control, use the registry method.
+
[role="tabbed-block"]
====

.NetApp Support Site
--

. Download the Astra Control Provisioner bundle (`astra-control-provisioner-[version].tar.gz`) from the https://mysupport.netapp.com/site/products/all/details/astra-control-center/downloads-tab[Astra Control Center downloads page^].

. Extract the Astra Control Provisioner image:
+
[source,console]
----
tar -vxzf astra-control-provisioner-[version].tar.gz
----

. Push the Astra Control Provisioner image to your custom registry.
//+
//NOTE: Docker commands are used in these examples. Podman commands can also be used.
//
//.. Change to the root directory of the tarball.
//
//.. Push the Astra Control Provisioner image to your custom registry. Make the following substitutions before running the `push-images` command:
//+
//
//* Replace <BUNDLE_FILE> with the name of the Astra Control Provisioner bundle file (`acp.manifest.bundle.yaml`).
// Replace <MY_FULL_REGISTRY_PATH> with the URL of the Docker repository; for example, "https://<docker-registry>".
//* Replace <MY_REGISTRY_USER> with the user name.
//* Replace <MY_REGISTRY_TOKEN> with an authorized token for the registry.
//+
//[source,console]
//----
//kubectl astra packages push-images -m <BUNDLE_FILE> -r <MY_FULL_REGISTRY_PATH> -u <MY_REGISTRY_USER> -p <MY_REGISTRY_TOKEN>
//----

--
// end NSS tab block

.Astra Control image registry
--

. Record your Astra Control account ID that you'll need to log in to the registry.
+
You can see your account ID in the Astra Control Service web UI. Select the figure icon at the top right of the page, select *API access*, and write down your account ID.

. From the same page, select *Generate API token* and copy the API token string to the clipboard and save it in your editor.

. Log into the Astra Control registry:
+
NOTE: You can use Podman instead of Docker for the following commands. If you are using a Windows environment, PowerShell is recommended.
+
[source,console]
----
docker login cr.astra.netapp.io -u <account-id> -p <api-token>
----

. Pull the image:
+
[source,console]
----
docker pull cr.astra.netapp.io/trident-acp:23.10
----

. Push the image to your custom registry:
+
[source,console]
----
docker run --rm -v "<my_custom_registry>:/package" cr.astra.netapp.io/trident-acp:23.10
----
--
// end registry tab block

====
// end overall tabbed block


. Determine if the original installation method used an https://docs.netapp.com/us-en/trident/trident-managing-k8s/uninstall-trident.html#determine-the-original-installation-method[operator (either manually or with Helm) or `tridentctl`^].
+
WARNING: Do not use Helm to enable Astra Control Provisioner. If you used Helm for the original installation and you are upgrading to 23.10, you'll need to use either the Trident operator or tridentctl to perform Astra Control Provisioner enablement.
+
[role="tabbed-block"]
====

.Astra Trident operator
--
//. Delete the Trident operator that was used to install the current Astra Trident instance. For example, if you are upgrading from Astra Trident 23.07, run the following command:
//+
//----
//kubectl delete -f 23.07/trident-installer/deploy/<bundle-name.yaml> -n trident
//----

. On the cluster that hosts Astra Trident, edit the TridentOrchestrator CR to enable Astra Control Provisioner (`enableACP: true`) and set the registry location for the Astra Control Provisioner image:
+
[subs=+quotes]
----
apiVersion: trident.netapp.io/v1
kind: TridentOrchestrator
metadata:
  name: trident
spec:
  debug: true
  namespace: trident
  imagePullPolicy: IfNotPresent
  windows: false
  *enableACP: true*
  *acpImage: my_custom_registry/trident-acp:v23.10.0*
----

. Apply the changes:
+
----
kubectl -n trident apply -f tridentorchestrator_cr.yaml
----

. Update Astra Trident configuration so that the new `trident-acp` container is deployed:
+
NOTE: For clusters running Kubernetes 1.24 or earlier, use `bundle_pre_1_25.yaml`. For clusters running Kubernetes 1.25 or later, use `bundle_post_1_25.yaml`.
+
----
kubectl -n trident apply -f trident-installer-23.10.0/deploy/<bundle-name.yaml>
----

. Verify the operator, deployment, and replicasets were created.
+
----
kubectl get all -n <operator-namespace>
----
+
IMPORTANT: There should only be *one instance* of the operator in a Kubernetes cluster. Do not create multiple deployments of the Trident operator.

. Verify the `trident-acp` container is running:
+
----
kubectl get pod -n trident trident-controller-<uuid> -o yaml/json
----
--

.tridentctl
--

. https://docs.netapp.com/us-en/trident/trident-managing-k8s/upgrade-tridentctl.html[Uninstall Astra Trident from the cluster that hosts it^].
. Install Astra Trident again with Astra Control Provisioner enabled (`--enable-acp=true`):
+
----
./tridentctl -n trident install --enable-acp=true --acp-image=mycustomregistry/trident-acp:v23.10
----

====
// end tabbed block

.Result

Astra Control Provisioner functionality is enabled and you can use any features available for the version you are running.

(For Astra Control Center users only) After Astra Control Provisioner is installed, the cluster hosting the provisioner in the Astra Control Center UI will show an `ACP version` rather than `Trident version` field and current installed version number.

image:ac-acp-version.png[A screenshot depicting the ACP version location in UI]

.For more information

* https://docs.netapp.com/us-en/trident/trident-managing-k8s/upgrade-operator-overview.html[Astra Trident upgrades documentation^]